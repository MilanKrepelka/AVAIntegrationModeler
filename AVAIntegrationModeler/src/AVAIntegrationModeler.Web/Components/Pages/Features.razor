@page "/features"
@using AVAIntegrationModeler.Web.ViewModels.List;
@using AVAIntegrationModeler.Web.Components.Widgets.IncludedModelsWidget
@using AVAIntegrationModeler.Web.Components.Widgets.IncludedFeaturesWidget
@inject ISnackbar Snackbar

<PageTitle>Integrační Featury</PageTitle>

<MudText Typo="Typo.h3" GutterBottom="true">Integrační featury</MudText>
<MudText Typo="Typo.body1" Class="mb-8"></MudText>

@if (FeatureList == null)
{
    <MudProgressCircular Color="Color.Default" Indeterminate="true" />
}
else
{
    <MudRadioGroup T="AVAIntegrationModeler.Contracts.Datasource" Class="mb-4" Value="Datasource" ValueChanged="onDatasourceChanded">
        <MudRadio Dense="true" Value="AVAIntegrationModeler.Contracts.Datasource.Database" Color="Color.Primary">Lokální vývoj</MudRadio>
        <MudRadio Dense="true" Value="AVAIntegrationModeler.Contracts.Datasource.AVAPlace" Color="Color.Secondary">AVA place</MudRadio>
    </MudRadioGroup>

    <MudDataGrid Items="@FeatureList" Filterable="false" QuickFilter="FilterFunc" ExpandSingleRow="false">

        <ToolBarContent>

            <MudSpacer />
            <MudTextField @bind-Value="this.FilterString" Placeholder="Hledat" Adornment="Adornment.Start" Immediate="true"
                          AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
        </ToolBarContent>
        <Columns>
            <HierarchyColumn T="FeatureListViewModel" EnableHeaderToggle=true />
            <PropertyColumn Property="x => x.Code" Title="Kód">

            </PropertyColumn>
            <PropertyColumn Property="x => x.Name.EnglishValue" Title="Název - anglicky" />
            <PropertyColumn Property="x => x.Description.EnglishValue" Title="Popis - anglicky" />
            <PropertyColumn Property="x => x.IncludedFeaturesText" Title="Includes Features" />
            <PropertyColumn Property="x => x.IncludedModelsText" Title="Includes Models" />
            <PropertyColumn Property="x => x.Id" Title="Identifikátor">
                <CellTemplate>
                    @context.Item.Id
                    <MudTooltip Text="Vložit do schránky" Color="Color.Info" Arrow>
                        <MudIconButton Icon="@Icons.Material.Filled.ContentCopy"
                                       Color="Color.Primary"
                                       Size="Size.Small"
                                       OnClick="@(() => CopyToClipboard(context.Item.Id.ToString()))" />
                    </MudTooltip>
                </CellTemplate>
            </PropertyColumn>

        </Columns>
        <ChildRowContent>
            <MudPaper Class="pa-6 ma-2" Elevation="2">
                <MudForm Spacing="4">
                    <MudGrid>
                        <MudItem xs="12" sm="6" md="4">
                            <MudField Label="Identifikátor" Variant="Variant.Text">@context.Item.Id</MudField>
                        </MudItem>
                        <MudItem xs="12" sm="6" md="4">
                            <MudField Label="Kód" Variant="Variant.Text">@context.Item.Code</MudField>
                        </MudItem>
                    </MudGrid>
                    <MudGrid>
                        <MudItem xs="12" sm="6" md="4">
                            <MudField Label="Název - anglicky" Variant="Variant.Text">@context.Item.Name.EnglishValue</MudField>
                        </MudItem>
                        <MudItem xs="12" sm="6" md="4">
                            <MudField Label="Popis - anglicky" Variant="Variant.Text">@context.Item.Description.EnglishValue</MudField>
                        </MudItem>
                    </MudGrid>
                    <MudGrid>
                        <MudItem xs="12" sm="6" md="4">
                            <MudField Label="Název - česky" Variant="Variant.Text">@context.Item.Name.CzechValue</MudField>
                        </MudItem>
                        <MudItem xs="12" sm="6" md="4">
                            <MudField Label="Popis - česky" Variant="Variant.Text">@context.Item.Description.CzechValue</MudField>
                        </MudItem>
                    </MudGrid>
                    

                    <MudGrid>
                        <MudItem xs="12">
                            <MudDivider Class="my-4" />
                            <IncludedFeaturesWidget Features="@context.Item.IncludedFeatures" ShowDetails="@true" />
                        </MudItem>
                    </MudGrid>

                    <MudGrid>
                        <MudItem xs="12">
                            <MudDivider Class="my-4" />
                            <IncludedModelsWidget Models="@context.Item.IncludedModels" ShowDetails="@true" />
                        </MudItem>
                    </MudGrid>
                </MudForm>
            </MudPaper>
        </ChildRowContent>
    </MudDataGrid>

}
@code
{
    [Inject] private IJSRuntime JS { get; set; } = default!;

    private async Task CopyToClipboard(string text)
    {
        await JS.InvokeVoidAsync("navigator.clipboard.writeText", text);
        Snackbar.Add($"Zkopírováno do schránky: {text}", Severity.Success);
    }
}